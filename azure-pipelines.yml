# Starter pipeline

# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- none

resources:
  repositories:
    - repository: template
      type: git
      name: Safe2Pay/yaml-templates
      ref: refs/heads/features/github-copy

pool:
  vmImage: 'windows-latest'

stages:
  
  - template: templates/stages/github-repository-sync.yml@template
    parameters:
      githubRepositoryName: 'PHP'


# - task: PowerShell@2
#   inputs:
#     targetType: 'inline'
#     script: |
#           # Write your PowerShell commands here.
#           Write-Host ' - - - - - - - - - - - - - - - - - - - - - - - - -'
#           Write-Host ' reflect Azure Devops repo changes to GitHub repo'
#           Write-Host ' - - - - - - - - - - - - - - - - - - - - - - - - - '
#           $stageDir = '$(Build.SourcesDirectory)' | Split-Path
#           $githubDir = $stageDir +"\"+"gitHub"
#           $destination = $githubDir +"\"+"sdk-php.git"
#           #please provide your username
#           #Please make sure, you remove https from azure-repo-clone-url
#           $sourceURL = 'https://suifqp2eg6dndxgnruhwmmnukxeao6ea3zgr34iknhas7htw3lwq@dev.azure.com/Safe2Pay/Safe2Pay/_git/sdk-php'
#           #Please make sure, you remove https from github-repo-clone-url
#           $destURL = 'https://' + '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' + '@github.com/SafeToPay/PHP.git'
#           #Check if the parent directory exists and delete
#           if((Test-Path -path $githubDir))
#           {
#             Remove-Item -Path $githubDir -Recurse -force
#           }
#           if(!(Test-Path -path $githubDir))
#           {
#             New-Item -ItemType directory -Path $githubDir
#             Set-Location $githubDir
#             git clone --mirror $sourceURL
#           }
#           else
#           {
#             Write-Host "The given folder path $githubDir already exists";
#           }
#           Set-Location $destination
#           Write-Output '*****Git removing remote secondary****'
#           git remote rm secondary
#           Write-Output '*****Git remote add****'
#           git remote add --mirror=fetch secondary $destURL
#           Write-Output '*****Git fetch origin****'
#           git fetch $sourceURL
#           Write-Output '*****Git push secondary****'
#           git push secondary agua/7156
#           Write-Output '**Azure Devops repo synced with Github repo**'
#           Set-Location $stageDir
#           if((Test-Path -path $githubDir))
#           {
#           Remove-Item -Path $githubDir -Recurse -force
#           }